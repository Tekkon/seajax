function SDBrowser_parseUserAgent(e){var t=null,i=null,n=null,r=null,o=/MSIE ([^\s;)]+)/.exec(e),a=/Firefox\/(\S+)/.exec(e),s=/Safari\/(\S+)/.exec(e),l=/Chrome\/(\S+)/.exec(e),c=/Version\/(\S+)/.exec(e),S=/; Trident\/([^\s;)]+)/.exec(e),h=/rv\:([^\s)]+)\) Gecko\//.exec(e),u=/WebKit\/(\S+)/.exec(e);return o?(t=SDBrowser_IE,i=o[1],n=SDBrowser_TRIDENT,S&&(r=S[1])):h?(n=SDBrowser_GECKO,r=h[1],a&&(t=SDBrowser_FF,i=a[1])):u&&(n=SDBrowser_WEBKIT,r=u[1],l?(t=SDBrowser_CHROME,i=l[1]):s&&c&&(t=SDBrowser_SAFARI,i=c[1],r=s[1])),{name:t,version:i,engine:n,engineVersion:r}}function SDTileCache(e){this.capacity=e>1?e:2,this.oldest=null,this.newest=null}function SDNetwork_generateTryMakeRequestMethod(e,t){return function(i,n,r){var o,a=e[i];return a?("function"==typeof n&&a.seadragon.callbacks.push(n),!0):(o=SDUri_getHostname(i),!(!SDNetwork_numSpotsAvailable(o)&&!r)&&(!!(a=t(i))&&(SDNetwork_markSpotTaken(o),e[i]=a,a.seadragon={url:i,hostname:o,callbacks:"function"==typeof n?[n]:[]},!0)))}}function SDNetwork_tryCallAll(e,t,i,n){var r,o=e.length;for(r=0;r<o;r++)try{e[r](t,i,n)}catch(a){SDDebug_warn("Seadragon2.Network callback {0} for {1} threw an error:\n{2}",r,t,a)}}function SDNetwork_generateResponseHandler(e,t){function i(){var i=this.seadragon,n=i.url;SDNetwork_markSpotOpen(i.hostname),delete e[n];try{delete this.seadragon}catch(r){this.seadragon=null}SDNetwork_tryCallAll(i.callbacks,n,t,this)}return window.ActiveXObject?SDFunction_delay(i,0):i}function Tile(e,t,i,n,r){var o=SDTileInfo_$(n.getTileInfo(e,t,i));this.level=e,this.col=t,this.row=i,this.tileBelow=r,this.url=o.url,this.crop=o.crop,this.bounds=n.getTileBounds(e,t,i),this.drawnOpaque=!1,this.tilesAbove=n.getNumTilesAbove(e,t,i),this.covered=0,this.loading=!1,this.area=0,this.distance=0,this.opacity=1,this.inBounds=!0,this.view=null}function Level(e,t){this.bounds=SDRect_nullRect,this.tiles={},this.num=e,this.visible=!1,this.fading=!1,this.tilesVisible=0,this.opacity=1,this.dimensions=t.getLevelDimensions(e),this.view=null}function SDTileLoader_compareNominatedUrls(e,t){var i,n=SDTileLoader_nominations[e],r=SDTileLoader_nominations[t],o=r.area-n.area;return o?o:(i=n.distance-r.distance,i?i:n.level-r.level)}function SDTileLoader_imgCallback(e,t,i){var n,r,o,a,s,l,c=SDTileLoader_imgInfos[e];c||SDDebug_error("Seadragon2.TileLoader: [internal] no img info for "+e),l=SDTileLoader_cache.insert(c),l&&delete SDTileLoader_imgInfos[l.url],c.loading=!1,c.loaded=t,c.failed=!t,c.img=i,n=c.tiles,r=c.callbacks,o=c.args;try{delete c.tiles,delete c.callbacks,delete c.args}catch(S){c.tiles=null,c.callbacks=null,c.args=null}for(s=n.length,a=0;a<s;a++)n[a]&&r[a](o[a],n[a],c);SDTileLoader_triggerProcessing()}function SDTileLoader_processNominations(){var e,t,i,n,r=[],o=SDNetwork_numSpotsAvailable();SDTileLoader_trigger=!1;for(i in SDTileLoader_nominations)SDTileLoader_nominations.hasOwnProperty(i)&&SDTileLoader_nominations[i]&&r.push(i);for(r.sort(SDTileLoader_compareNominatedUrls),t=r.length,e=0;e<t&&o>0;e++)if(i=r[e],SDNetwork_tryMakeImageRequest(i,SDTileLoader_imgCallback)){o--,n=SDTileLoader_nominations[i],SDTileLoader_imgInfos[i]={loading:!0,loaded:!1,failed:!1,img:null,tiles:n.tiles,callbacks:n.callbacks,args:n.args,url:i};try{delete SDTileLoader_nominations[i]}catch(a){SDTileLoader_nominations[i]=null}}}function SDTileLoader_nominate(e,t,i){var n=e.url,r=SDTileLoader_imgInfos[n];return r?void(r.tiles?(r.tiles.push(e),r.callbacks.push(t),r.args.push(i),r.nominators++):SDDebug_warn("Nomination dropped: "+n)):(r=SDTileLoader_nominations[n],r?(r.tiles.push(e),r.callbacks.push(t),r.args.push(i),r.area+=e.area,r.distance=SDMath_min(r.distance,e.distance),r.nominators++):SDTileLoader_nominations[n]={tiles:[e],callbacks:[t],args:[i],nominators:1,area:e.area,distance:e.distance,level:e.level},SDTileLoader_triggerProcessing(),SDTileLoader_nominations[n].tiles.length-1)}function SDTileLoader_getImgInfo(e){var t=SDTileLoader_imgInfos[e];return t&&!t.loading&&SDTileLoader_cache.refresh(t),t||SDTileLoader_nullImgInfo}function SDImageManager_checkForInit(){var e,t,i,n,r,o=document.getElementsByTagName("sdimg"),a=o.length;for(e=0;e<a;e++)if(t=o[e],!t.update){for(n=t.nextSibling,r=t.parentNode;t.hasChildNodes();)i=t.firstChild,t.removeChild(i),"sdimgcontainerdiv"!==i.className&&(n?r.insertBefore(i,n):r.appendChild(i));new SDImage(null,o[e])}return!0}function SDImageState_blendCallback(e,t){var i,n=e.levelData,r=e.tile,o=e.startTime,a=e.state,s=e.last||o;return!(!n.visible||!r.inBounds||r.isCovered()||n.fading||r.drawnOpaque)&&(i=(t-o)/a.blendInTime,(i>1||t-s>67)&&(i=1),a.drawer.updateBlend(r,n.view,i),r.opacity=i,1===i?(n.fading||a.onDrawn(r),!1):(e.last=t,!0))}function SDImageState_fadeCallback(e,t){var i,n=e.state,r=e.levelData,o=e.level,a=n.levels,s=e.startTime,l=e.last||s;return a[o]===r&&(i=1-(t-s)/n.fadeOutTime,t-l>67&&(i=0),i<=0?(r.visible&&n.drawer.removeLevel(r.view),delete a[o],!1):(r.visible&&(r.opacity=i,n.drawer.updateFade(r.view,i)),e.last=t,!0))}function SDImageState_onTileLoad(e,t,i){var n=e.levelData,r=n.bounds,o=e.state;t.loading=!1,!i.failed&&r&&t.inBounds&&n.visible&&!n.fading&&(t.isCovered()||o.blendTile(i.img,t))}function SDImage_onSrcClear(e){e.state&&e.state.destroy(),e.state=null}function SDImage_onTileSourceLoad(e,t,i){e.immediateMode&&e.parentNode?e.immediateMode=!1:e.skippedParentCheck=SDMath_floor(30*Math.random());var n=e.immediateMode?SDDrawer_nullDrawer:SDDrawer_$(e.container,t.normHeight);e.state=new SDImageState(t,n,e.blendTime,e.fadeTime),SDEvent_raise(e,"load",!1)}function SDImage_fetchSrc(e,t){SDDeepZoom_fetchTileSource(t,function(i){i instanceof SDTileSource?SDImage_onTileSourceLoad(e,i):SDDebug_warn("SDImage: failed to fetch tile source at "+t)})}function SDImage_onSrcSet(e){var t=e.src,i=typeof t;"string"===i?SDImage_fetchSrc(e,t):"object"===i?SDImage_onTileSourceLoad(e,SDTileSource_$(t)):SDDebug_error("Unsupported src type: "+i)}function SDImage_onSrcChange(e){SDImage_onSrcClear(e),SDImage_onSrcSet(e)}function SDImage_onTickSrcEmpty(e){}function SDImage_onTickSrcSet(e,t,i){if(e.state){e.immediateMode&&(e.skippedParentCheck>30?(e.parentNode&&(e.immediateMode=!1,SDImage_onTileSourceLoad(e,e.state.source)),e.skippedParentCheck=0):e.skippedParentCheck++);var n,r,o=e.container,a=t||SDElement_getBoundingClientRect(o),s=a.width,l=a.height;t||i?r=i:(n=SDElement_getWindowDimensions(),e.clipParent&&(n=n.intersect(SDElement_getBoundingClientRect(e.clipParent)),n||(n=new SDRect(0,0,0,0))),r=SDElement_getClippingBounds(o,a,n)),s&&l&&(t||(a.x-=n.width/2,a.y-=n.height/2),e.state.update(a,r,e.blur-SDImage_pixelRatio))}}function SDImage_onTick(e,t,i,n){var r=e.lastSrc,o=e.src;return!r&&o?SDImage_onSrcSet(e):r&&!o?SDImage_onSrcClear(e):o!==r?SDImage_onSrcChange(e):o?o?SDImage_onTickSrcSet(e,i,n):SDDebug_warn("SDImage_onTick: unknown state! src={0}, lastSrc={1}",o,r):SDImage_onTickSrcEmpty(e),e.lastSrc=o,!0}"undefined"==typeof Seadragon2&&(window.Seadragon2={});var SD=Seadragon2,SD_VERSION=SD.VERSION="2.0.pre";SD.toString=function(){return"Seadragon Ajax v"+SD_VERSION+"\nCopyright (c) Microsoft Corp."};var SDPoint=SD.Point=function(e,t){this.x=e||0,this.y=t||0},SDPoint_$=SDPoint.$=function(e){return e instanceof SDPoint?e:(e=e||{},new SDPoint(e.x,e.y))},SDPointPrototype=SDPoint.prototype,SDPoint_origin=new SDPoint(0,0);SDPointPrototype.plus=function(e){return new SDPoint(this.x+e.x,this.y+e.y)},SDPointPrototype.minus=function(e){return new SDPoint(this.x-e.x,this.y-e.y)},SDPointPrototype.times=function(e){return new SDPoint(this.x*e,this.y*e)},SDPointPrototype.divide=function(e){return new SDPoint(this.x/e,this.y/e)},SDPointPrototype.negate=function(){return new SDPoint((-this.x),(-this.y))},SDPointPrototype.apply=function(e){return new SDPoint(e(this.x),e(this.y))},SDPointPrototype.distanceTo=function(e){var t=this.x-e.x,i=this.y-e.y;return Math.sqrt(t*t+i*i)},SDPointPrototype.asSize=function(){return new SDSize(this.x,this.y)},SDPointPrototype.equals=function(e){return this.x===(e.x||0)&&this.y===(e.y||0)},SDPointPrototype.toString=function(){return["(",this.x,",",this.y,")"].join("")};var SDSize=SD.Size=function(e,t){this.width=e||0,this.height=t||0},SDSize_$=SDSize.$=function(e){return e instanceof SDSize?e:(e=e||{},new SDSize(e.width,e.height))},SDSizePrototype=SDSize.prototype;SDSizePrototype.plus=function(e){return new SDSize(this.width+e.width,this.height+e.height)},SDSizePrototype.minus=function(e){return new SDSize(this.width-e.width,this.height-e.height)},SDSizePrototype.times=function(e){return new SDSize(this.width*e,this.height*e)},SDSizePrototype.divide=function(e){return new SDSize(this.width/e,this.height/e)},SDSizePrototype.negate=function(){return new SDSize((-this.width),(-this.height))},SDSizePrototype.apply=function(e){return new SDSize(e(this.width),e(this.height))},SDSizePrototype.asPoint=function(){return new SDPoint(this.width,this.height)},SDSizePrototype.equals=function(e){return this.width===(e.width||0)&&this.height===(e.height||0)},SDSizePrototype.toString=function(){return["(",this.width,"x",this.height,")"].join("")};var SDRect=SD.Rect=function(e,t,i,n){e&&void 0===i&&void 0!==e.x&&(i=t.width,n=t.height,t=e.y,e=e.x),this.x=e||0,this.y=t||0,this.width=i||0,this.height=n||0},SDRect_$=SDRect.$=function(e){return e instanceof SDRect?e:new SDRect(e.x,e.y,e.width,e.height)},SDRectPrototype=SDRect.prototype,SDRect_unitRect=new SDRect(0,0,1,1),SDRect_nullRect=new SDRect((-1),(-1),(-1),(-1));SDRectPrototype.getArea=function(){return this.width*this.height},SDRectPrototype.getAspectRatio=function(){return this.width/this.height},SDRectPrototype.getNormHeight=function(){return this.height/this.width},SDRectPrototype.getTopLeft=function(){return new SDPoint(this.x,this.y)},SDRectPrototype.getBottomRight=function(){return new SDPoint(this.x+this.width,this.y+this.height)},SDRectPrototype.getCenter=function(){return new SDPoint(this.x+this.width/2,this.y+this.height/2)},SDRectPrototype.getSize=function(){return new SDSize(this.width,this.height)},SDRectPrototype.contains=function(e){var t=this.x+this.width,i=this.y+this.height,n=e.x+(e.width||0),r=e.y+(e.height||0);return this.x<=e.x&&this.y<=e.y&&t>=n&&i>=r},SDRectPrototype.union=function(e){var t=Math.min(this.x,e.x),i=Math.min(this.y,e.y),n=Math.max(this.x+this.width,e.x+(e.width||0)),r=Math.max(this.y+this.height,e.y+(e.height||0));return new SDRect(t,i,n-t,r-i)},SDRectPrototype.intersect=function(e){var t=Math.max(this.x,e.x),i=Math.max(this.y,e.y),n=-t+Math.min(this.x+this.width,e.x+(e.width||0)),r=-i+Math.min(this.y+this.height,e.y+(e.height||0));return n||r||e instanceof SDRect?n<0||r<0?null:new SDRect(t,i,n,r):new SDPoint(t,i)},SDRectPrototype.scale=function(e,t){var i=t?t.x:this.x,n=t?t.y:this.y;return new SDRect(i-e*(i-this.x),n-e*(n-this.y),this.width*e,this.height*e)},SDRectPrototype.translate=function(e){return new SDRect(this.x+(e.x||0),this.y+(e.y||0),this.width,this.height)},SDRectPrototype.equals=function(e){return this.x===(e.x||0)&&this.y===(e.y||0)&&this.width===(e.width||0)&&this.height===(e.height||0)},SDRectPrototype.toString=function(){return["[",this.x,",",this.y,"|",this.width,"x",this.height,"]"].join("")};var SDString=SD.String={},SDString_format=SDString.format=function(e,t){var i,n;if(2===arguments.length&&t&&t.constructor&&(t.constructor===Array||t.constructor===Object))i=t;else for(i=new Array(arguments.length-1),n=0;n<i.length;n++)i[n]=arguments[n+1];return e.replace(/\{[\d\w]+\}/g,function(e){var t=e.match(/[\d\w]+/);return i[t]||""})},SDDebug=SD.Debug={alert:0,enabled:3},SDDebug_log=SDDebug.log=function(e,t){SDDebug.enabled<3||(arguments.length>1&&(e=SDString_format.apply(this,arguments)),"undefined"!=typeof console&&console.log?console.log(e):SDDebug.alert>=3&&alert(e))},SDDebug_warn=SDDebug.warn=function(e){SDDebug.enabled<2||(arguments.length>1&&(e=SDString_format.apply(this,arguments)),"undefined"!=typeof console&&console.warn?console.warn(e):SDDebug.alert>=2&&alert(e))},SDDebug_error=SDDebug.error=function(e,t){if(!(SDDebug.enabled<1))throw"undefined"!=typeof console&&console.error?console.error(e):SDDebug.alert>=1&&alert(e),t||new Error(e)},SDObject=SD.Object={},SDObject_extend=SDObject.extend=function(e,t,i){for(var n in t)(i||t.hasOwnProperty(n))&&(e[n]=t[n]);return e},SDObject_clone=SDObject.clone=function(e,t){return SDObject_extend({},e,t)},SDFunction=SD.Function={},SDFunction_EMPTY=SDFunction.EMPTY=function(){},SDFunction_bind=SDFunction.bind=function(e,t,i){var n,r=new Array(arguments.length-2),o=r.length;for(n=0;n<o;n++)r[n]=arguments[n+2];return"string"==typeof t&&(t=e[t]),function(){var i,n=arguments.length;for(i=0;i<n;i++)r.push(arguments[i]);t.apply(e,r)}},SDFunction_callback=SDFunction.callback=function(e,t){var i,n=arguments.length,r=new Array(n+1);for(r[0]=null,i=0;i<n;i++)r[i+1]=arguments[i];return SDFunction_bind.apply(SDFunction,r)},SDFunction_delay=SDFunction.delay=function(e,t){return function(){setTimeout(SDFunction_bind(this,e),t)}},SDBrowser=SD.Browser={},SDBrowser_TRIDENT=SDBrowser.TRIDENT="Trident",SDBrowser_GECKO=SDBrowser.GECKO="Gecko",SDBrowser_WEBKIT=SDBrowser.WEBKIT="Webkit",SDBrowser_PRESTO=SDBrowser.PRESTO="Presto",SDBrowser_IE=SDBrowser.IE="IE",SDBrowser_FF=SDBrowser.FIREFOX="Firefox",SDBrowser_SAFARI=SDBrowser.SAFARI="Safari",SDBrowser_CHROME=SDBrowser.CHROME="Chrome",SDBrowser_OPERA=SDBrowser.OPERA="Opera",SDBrowser_isIE,SDBrowser_isFF,SDBrowser_isSafari,SDBrowser_isChrome,SDBrowser_isGecko,SDBrowser_isWebkit,SDBrowser_isOpera;!function(){var e=SDBrowser_parseUserAgent(navigator.userAgent),t=e.name,i=e.version,n=parseInt(i),r=(parseFloat(i),e.engine),o=e.engineVersion;parseFloat(o);SDBrowser.name=t,SDBrowser.version=i,SDBrowser.engine=r,SDBrowser.engineVersion=o,e.name===SDBrowser_IE?SDBrowser_isIE=n:e.name===SDBrowser_FF?SDBrowser_isFF=n:e.name===SDBrowser_SAFARI?SDBrowser_isSafari=n:e.name===SDBrowser_CHROME&&(SDBrowser_isChrome=n)}();var SDMath=SD.Math={},SDMath_max=Math.max,SDMath_min=Math.min,SDMath_clamp=SDMath.clamp=function(e,t,i){return SDMath_max(t,SDMath_min(i,e))},SDMath_ln=Math.log,SDMath_LN2=Math.LN2,SDMath_LN10=Math.LN10,SDMath_exp=Math.exp,SDMath_log=SDMath.log=function(e,t){return t?SDMath_ln(e)/SDMath_ln(t):SDMath_ln(e)},SDMath_log2=SDMath.log2=function(e){return SDMath_ln(e)/SDMath_LN2},SDMath_log10=SDMath.log10=function(e){return SDMath_ln(e)/SDMath_LN10},SDMath_morton=SDMath.morton=function(e){var t,i,n,r,o,a=arguments[0];for("object"==typeof a?(t=a.x,i=a.y):(t=a,i=arguments[1]),n=0,r=0,o=1;o<=t||o<=i;)o&t&&(n|=1<<2*r+1),o&i&&(n|=1<<2*r),r++,o=1<<r;return n},SDMath_reverseMorton=SDMath.reverseMorton=function(e){for(var t,i=[],n=[],r=0,o=0;e>0;)n.push(e%2),e>>=1,i.push(e%2),e>>=1;for(t=0;t<i.length;t++)r+=(1<<t)*i[t];for(t=0;t<n.length;t++)o+=(1<<t)*n[t];return new SDPoint(r,o)},SDMath_ceil=Math.ceil,SDMath_floor=Math.floor,SDMath_round=SDMath.round=function(e,t,i){return"undefined"==typeof i&&(i=1),"undefined"==typeof t&&(t=.5),e/=i,(e%1+1)%1<t?SDMath_floor(e)*i:SDMath_ceil(e)*i},SDUri=SD.Uri={},SDUri_FILE_HOSTNAME=SDUri.FILE_HOSTNAME="localhost",SDUri_PAGE_HOSTNAME=location.hostname||SDUri_FILE_HOSTNAME,SDUri_getHostname=SDUri.getHostname=function(e){var t,i=/^http[s]?:\/\/([\w-.]+)/i.exec(e);return i?i[1].toLowerCase():(t=/^file:\/\//i.exec(e))?SDUri_FILE_HOSTNAME:SDUri_PAGE_HOSTNAME},SDXml=SD.Xml={},SDXml_fetch=SDXml.fetch=function(){function e(e,t){return function(){4===this.readyState&&(0===this.status||this.status>=200&&this.status<300?e.call(this):t.call(this))}}var t,i,n,r,o=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml3.XMLHTTP"],a="undefined"!=typeof XDomainRequest;if("undefined"!=typeof XMLHttpRequest)n=XMLHttpRequest;else if("undefined"!=typeof ActiveXObject){for(i=0;i<o.length;i++){t=o[i];try{new ActiveXObject(t),n=ActiveXObject,r=t;break}catch(s){SDDebug_warn("Seadragon2.Xml: {0} ActiveX failed.",t)}}i>=o.length&&SDDebug_error("Seadragon2.Xml: no ActiveX worked.")}else SDDebug_error("Seadragon2.Xml: no fetching ability.");return n?function(t,i,o,s,l){var c=new n(r),S=s?"POST":"GET",h=!1;c.onreadystatechange=e(i,o),t=t.replace(/#.*/,"");try{c.open(S,t,!0)}catch(u){if(!a)throw u;c=new XDomainRequest,c.onload=i,c.onerror=o,c.timeout=3e4,c.ontimeout=function(){},c.onprogress=function(){},c.open(S,t),h=!0}return s&&c.setRequestHeader&&c.setRequestHeader("Content-Type",l||"text/plain"),h?setTimeout(function(){c.send(s||null)},0):c.send(s||null),c}:SDFunction_EMPTY}(),SDXml_parse=SDXml.parse=function(){return"undefined"!=typeof DOMParser?function(e){var t=new DOMParser,i=t.parseFromString(e,"text/xml"),n=i&&i.documentElement;return n&&"parsererror"!==n.nodeName?i:null}:"undefined"!=typeof ActiveXObject?function(e){var t=new ActiveXObject("Microsoft.XMLDOM");return t.async=!1,t.loadXML(e)&&t}:(SDDebug_error("Seadragon2.Xml: no parsing ability."),SDFunction_EMPTY)}(),SDElement=SD.Element={},SDElement_$=SDElement.$=function(e){return"string"==typeof e?document.getElementById(e):e},SDElement_getWindowDimensions=SDElement.getWindowDimensions=function(){return(SDElement_getWindowDimensions="undefined"!=typeof innerWidth?SDElement.getWindowDimensions=function(){return new SDRect(0,0,innerWidth,innerHeight)}:document.documentElement&&document.documentElement.clientHeight?SDElement.getWindowDimensions=function(){var e=document.documentElement;return new SDRect(0,0,e.clientWidth,e.clientHeight)}:document.body.clientHeight?SDElement.getWindowDimensions=function(){var e=document.body;return new SDRect(0,0,e.clientWidth,e.clientHeight)}:SDElement.getWindowDimensions=function(){return new SDRect(0,0,1/0,1/0)})()},SDElement_getBoundingClientRect=SDElement.getBoundingClientRect=function(e){var t=e.getBoundingClientRect();return new SDRect(t.left,t.top,t.right-t.left,t.bottom-t.top)},SDElement_getStyle=SDElement.getStyle=function(e){return window.getComputedStyle?getComputedStyle(e,null):e.currentStyle?e.currentStyle:void SDDebug_error("Unknown element style, no known technique.")},SDElement_getOffsetParent=SDElement.getOffsetParent=function(e,t){return t&&e!==document.body?document.body:e.offsetParent},SDElement_getPosition=SDElement.getPosition=function(e){for(var t=new SDPoint,i="fixed"===SDElement_getStyle(e).position,n=SDElement_getOffsetParent(e,i);n;)t.x+=e.offsetLeft,t.y+=e.offsetTop,i&&(t=t.plus(SDPage_getScroll())),e=n,i="fixed"===SDElement_getStyle(e).position,n=SDElement_getOffsetParent(e,i);return t},SDElement_getClippingBounds=SDElement.getClippingBounds=function(e,t,i){t=t||SDElement_getBoundingClientRect(e),i=i||SDElement_getWindowDimensions();var n,r,o,a,s=t.y,l=t.width+t.x,c=t.height+t.y,S=t.x,h=i.x,u=i.y,D=h+i.width,d=u+i.height;return n=SDMath_max(0,u-s),r=SDMath_max(0,h-S),o=SDMath_min(l,D)-S-r,a=SDMath_min(c,d)-s-n,new SDRect(r,n,o,a)},SDElement_setOpacity=SDElement.setOpacity=function(){var e=document.createElement("div");return"undefined"!=typeof e.style.opacity?function(e,t){e.style.opacity=t}:"undefined"!=typeof e.style.filter?function(e,t){var i,n,r,o="progid:DXImageTransform.Microsoft.Alpha(Opacity="+100*t+")";for(e.style.filter=o,i=e.children,r=i.length,n=0;n<r;n++)try{SDElement_setOpacity(i[n],t)}catch(a){}}:function(){}}(),SDElement_customElements={},SDElement_dce=document.createElement,SDElement_registerCustomElement=function(e,t){SDElement_customElements["sd_"+e]=t,SDElement_dce.call(document,e)},SDElement_transform=SDElement.transform=function(){var e,t,i,n,r=["MozTransform","msTransform","OTransform","WebkitTransform","transform"],o=document.documentElement.style,a="";for(e=r.length-1;e>=0;e--)if("undefined"!=typeof o[r[e]]){t=r[e],i=t+"Origin";break}return"MozTransform"===t&&(a="px"),n=t?function(e,n,r,o){var s=e.sdStyle;s||(s=e.sdStyle=e.style,s[i]="0 0"),n+=a,r+=a,o+=",",s[t]="matrix("+o+"0,0,"+o+n+","+r+")"}:function(e,t,i,n){var r=e.style;r.left=t+"px",r.top=i+"px",r.fontSize=n+"em",r.width=100*n+"%",r.height=100*n+"%"}}();document.createElement=function(e){var t=SDElement_customElements["sd_"+e];return t?new t:SDElement_dce.apply(this,arguments)};var SDEvent=SD.Event={},SDEvent_$=SDEvent.$=function(e){return e?e:"undefined"!=typeof event?event:null},SDEvent_raise=SDEvent.raise=function(){return document.createEvent?function(e,t,i){i=i||!1;var n=document.createEvent("HTMLEvents");return n.initEvent(t,i,!0),e.dispatchEvent(n)}:document.createEventObject?function(e,t){var i=document.createEventObject();try{return e.fireEvent("on"+t,i)}catch(n){SDDebug_warn("Event not fired: "+t+". "+n.message)}}:(SDDebug_error("Seadragon2.Event: no raise ability."),SDFunction_EMPTY)}(),SDEvent_add=SDEvent.add=function(){return"function"==typeof addEventListener?function(e,t,i,n){n=n||!1,e.addEventListener(t,i,n),"mousewheel"===t?e.addEventListener("DOMMouseScroll",i,n):"DOMMouseScroll"===t&&e.addEventListener("mousewheel",i,n)}:"undefined"!=typeof attachEvent?function(e,t,i,n){e.attachEvent("on"+t,i),"DOMMouseScroll"===t&&e.attachEvent("onmousewheel",i),n&&e.setCapture&&e.setCapture()}:(SDDebug_error("Seadragon2.Event: no add ability."),SDFunction_EMPTY)}(),SDEvent_remove=SDEvent.remove=function(){return"function"==typeof removeEventListener?function(e,t,i,n){n=n||!1,e.removeEventListener(t,i,n),"mousewheel"===t?e.removeEventListener("DOMMouseScroll",i,n):"DOMMouseScroll"===t&&e.removeEventListener("mousewheel",i,n)}:"undefined"!=typeof detachEvent?function(e,t,i,n){e.detachEvent("on"+t,i),"DOMMouseScroll"===t&&e.detachEvent("onmousewheel",i),n&&e.releaseCapture&&e.releaseCapture()}:(SDDebug_error("Seadragon2.Event: no remove ability."),SDFunction_EMPTY)}(),SDTimer=SD.Timer=new function(){function e(){var e,t,i=(new Date).getTime();for(e=s;e;e=e.next){try{t=e.callback(e.arg,i)}catch(n){SDDebug_warn("Exception caught in timer: "+n.message)}t||a.unregister(e)}}var t,i,n,r,o,a=this,s=null,l=16,c=null;this.register=function(e,t){var n={callback:e,arg:t};return n.next=s,s&&(s.prev=n),n.prev=null,s=n,i(),n},this.unregister=function(e){e.dead||(e.next&&(e.next.prev=e.prev),e.prev?e.prev.next=e.next:s=e.next,s||n(),e.dead=!0)},"function"==typeof requestAnimationFrame?r=requestAnimationFrame:"function"==typeof mozRequestAnimationFrame?r=mozRequestAnimationFrame:"function"==typeof webkitRequestAnimationFrame?r=webkitRequestAnimationFrame:"function"==typeof msRequestAnimationFrame&&(r=msRequestAnimationFrame),r?(t=function(){return o?(o=!1,void(c=null)):(e(),void r(t))},i=function(){o=!1,c||(c=!0,r(t))},n=function(){c&&(o=!0)}):(i=function(){null===c&&(c=setInterval(e,l))},n=function(){null!==c&&(clearInterval(c),c=null)})};SDTileCache.prototype.insert=function(e){var t=null;return this.capacity<=0&&(t=this.oldest,this.remove(t)),this.capacity--,e.cacheOlder=this.newest,this.newest?this.newest.cacheNewer=e:this.oldest=e,this.newest=e,e.cacheNewer=null,t},SDTileCache.prototype.remove=function(e){this.capacity++,e.cacheOlder?e.cacheOlder.cacheNewer=e.cacheNewer:this.oldest=e.cacheNewer,e.cacheNewer?e.cacheNewer.cacheOlder=e.cacheOlder:this.newest=e.cacheOlder},SDTileCache.prototype.refresh=function(e){this.remove(e),this.insert(e)};var SDTileInfo=SD.TileInfo=function(e,t){this.url=e,this.crop=t?SDRect_$(t):null},SDTileInfo_$=SDTileInfo.$=function(e){return e instanceof SDTileInfo?e:"string"==typeof e?new SDTileInfo(e,null):new SDTileInfo(e.url,e.crop)},SDTileSource=SD.TileSource=function(e,t,i,n,r,o,a){3===arguments.length&&"object"==typeof i&&(n=i.height,i=i.width);var s=SDMath_log2(Math.max(e,t)),l=SDMath_ceil(s),c=SDMath_log2(i);this.width=e,this.height=t,this.tileWidth=i||n,this.tileHeight=n||i,this.tileOverlap=r||0,this.minLevel=SDMath_clamp(o||0,0,l),this.overviewLevel=SDMath_clamp("number"==typeof a?a:c,this.minLevel,l),this.dimensions=new SDSize(e,t),this.aspectRatio=e/t,this.normHeight=t/e,this.tileSize=new SDSize(this.tileWidth,this.tileHeight),this.maxLevel=l,this.sharpen=l-s},SDTileSource_$=SDTileSource.$=function(e){var t,i,n,r;if(e instanceof SDTileSource)return e;"object"==typeof e.tileSize?(n=e.tileSize.width,r=e.tileSize.height):"number"==typeof e.tileSize&&(n=r=e.tileSize),t=new SDTileSource(e.width,e.height,e.tileWidth||n,e.tileHeight||r,e.tileOverlap,e.minLevel,e.maxLevel);for(i in e)e.hasOwnProperty(i)&&"tileSize"!==i&&(t[i]=e[i]);return t},SDTileSourcePrototype=SDTileSource.prototype;SDTileSourcePrototype.getLevelScale=function(e){var t=this.maxLevel-e;return t<31?1/(1<<t):Math.pow(.5,t)},SDTileSourcePrototype.getNumTiles=function(e){var t=this.getLevelScale(e);return new SDSize(Math.ceil(t*this.width/this.tileWidth),Math.ceil(t*this.height/this.tileHeight))},SDTileSourcePrototype.getPixelRatio=function(e){var t=this.getLevelDimensions(e);return new SDSize(1/t.width,1/t.height)},SDTileSourcePrototype.getTileAtPoint=function(e,t,i){var n=SDPoint_$(t).times(this.getLevelDimensions(e).width);return i&&(n.x%1===0&&n.x--,n.y%1===0&&n.y--),new SDPoint(Math.floor(n.x/this.tileWidth),Math.floor(n.y/this.tileHeight))},SDTileSourcePrototype.getTilesInRect=function(e,t){var i,n,r,o,a=this.getTileAtPoint(e,t.getTopLeft()),s=this.getTileAtPoint(e,t.getBottomRight(),!0),l=this.getNumTiles(e);return i=SDMath_max(a.x,0),r=SDMath_max(a.y,0),n=SDMath_min(s.x,l.width-1),o=SDMath_min(s.y,l.height-1),new SDRect(i,r,n-i,o-r)},SDTileSourcePrototype.getTileBounds=function(e,t,i){var n,r,o=this.getLevelDimensions(e),a=1/o.width,s=this.normHeight/o.height;return n=0===t?0:this.tileWidth*t-this.tileOverlap,r=0===i?0:this.tileHeight*i-this.tileOverlap,new SDRect(a*n,s*r,a*Math.min(this.tileWidth+(0===t?1:2)*this.tileOverlap,o.width-n),s*Math.min(this.tileHeight+(0===i?1:2)*this.tileOverlap,o.height-r))},SDTileSourcePrototype.getTileInfo=function(e,t,i){return null},SDTileSourcePrototype.levelExists=function(e){return!0},SDTileSourcePrototype.tileExists=function(e,t,i){return!0},SDTileSourcePrototype.getLevelDimensions=function(e){return this.dimensions.times(this.getLevelScale(e)).apply(SDMath_ceil)},SDTileSourcePrototype.getTileBelow=function(e,t,i,n){var r,o,a;return"undefined"==typeof n&&(n=e-1),n<this.minLevel||!this.levelExists(n)?null:(r=this.getLevelScale(e),o=this.getLevelScale(n),a=o/r,new SDPoint(SDMath_floor(t*a),SDMath_floor(i*a)))},SDTileSourcePrototype.getTilesAbove=function(e,t,i,n){var r,o,a,s,l;return"undefined"==typeof n&&(n=e+1),n>this.maxLevel||!this.levelExists(n)?null:(l=this.getNumTiles(n),r=this.getLevelScale(e),o=this.getLevelScale(n),a=o/r,s=new SDRect(t*a,i*a,a-1,a-1),s.x+s.width>=l.width&&(s.width=l.width-s.x-1),s.y+s.height>=l.height&&(s.height=l.height-s.y-1),s)},SDTileSourcePrototype.getNumTilesAbove=function(e,t,i,n){var r=this.getTilesAbove(e,t,i,n);return r?(r.width+1)*(r.height+1):1/0};var SDDisplayRect=SD.DisplayRect=function(e,t,i,n,r,o){this.base(e,t,i,n),this.base=this.base.prototype,this.minLevel=r||0,this.maxLevel=o||Number.POSITIVE_INFINITY},SDDisplayRect$=SDDisplayRect.$=function(e){return e instanceof SDDisplayRect?e:new SDDisplayRect(e.x,e.y,e.width,e.height,e.minLevel,e.maxLevel)},SDDisplayRectPrototype=SDDisplayRect.prototype=new SDRect;SDDisplayRectPrototype.base=SDRect,SDDisplayRectPrototype.equals=function(e){return this.base.equals.call(this,e)&&(this.minLevel===e.minLevel||0)&&(this.maxLevel===e.maxLevel||0)},SDDisplayRectPrototype.toString=function(){return this.base.toString.call(this).replace("]",["|",this.minLevel,"-",this.maxLevel,"]"].join(""))};var SDDziTileSource=SD.DziTileSource=function(e,t,i,n,r,o,a){this.base(e,t,i,i,n),this.base=this.base.prototype,this.tilesUrl=r,this.imageFormat=o,this.displayRects=a,this.isSparse=!!(a&&a.length>1),this.displayRectsByLevel=function(){var e,t,i,n,r,o=this.displayRects,a={};if(!this.isSparse)return null;for(e=0;e<o.length;e++)for(t=o[e],n=Math.max(t.minLevel,this.minLevel),r=Math.min(t.maxLevel,this.maxLevel),i=n;i<=r;i++)a[i]?a[i].push(t):a[i]=[t];return a}.call(this)},SDDziTileSource$=SDDziTileSource.$=function(e){var t;return e instanceof SDDziTileSource?e:(t=e.tileSize,"object"==typeof t&&(t=t.width||t.height),new SDDziTileSource(e.width,e.height,t||e.tileWidth||e.tileHeight,e.tileOverlap,e.tilesUrl,e.imageFormat,e.displayRects))},SDDziTileSourcePrototype=SDDziTileSource.prototype=new SDTileSource;SDDziTileSourcePrototype.base=SDTileSource,SDDziTileSourcePrototype.getTileInfo=function(e,t,i){return[this.tilesUrl,e,"/",t,"_",i,".",this.imageFormat].join("")},SDDziTileSourcePrototype.tileExists=function(e,t,i){var n,r,o,a,s,l,c,S,h,u,D,d;if(!this.isSparse)return!0;if(o=this.displayRectsByLevel[e],!o||!o.length)return!1;for(n=0;n<o.length;n++)if(r=o[n],a=this.getLevelScale(e),s=r.x*a,c=r.y*a,l=s+r.width*a,S=c+r.height*a,h=Math.floor(s/this.tileWidth),D=Math.floor(c/this.tileHeight),u=Math.ceil(l/this.tileWidth),d=Math.ceil(S/this.tileHeight),h<=t&&t<u&&D<=i&&i<d)return!0;return!1},SDDziTileSourcePrototype.getTileBelow=function(e,t,i,n){return void 0===n&&(n=e-1),n<=this.dzcMaxLevel?n<this.minLevel||!this.levelExists(n)?null:SDPoint_origin:SDTileSourcePrototype.getTileBelow.call(this,e,t,i,n)};var SDDzcTileSource=SD.DzcTileSource=function(e,t,i,n,r,o,a,s,l){this.base(e,t,i),this.base=this.base.prototype,this.dzcTileSize=i,this.dzcMaxLevel=n,this.dzcItemId=r,this.dzcTilesUrl=o,this.dzcImageFormat=a,this.dzcExpansionUrl=l,this.dziSource=null,this.dziSourceRequested=!1,this.dzcItemCoords=SDMath_reverseMorton(s)},SDDzcTileSource$=SDDzcTileSource.$=function(e){return e instanceof SDDzcTileSource?e:new SDDzcTileSource(e.width,e.height,e.dzcTileSize,e.dzcMaxLevel,e.dzcItemId,e.dzcTilesUrl,e.dzcImageFormat,e.dzcItemN,e.dzcExpansionUrl)},SDDzcTileSourcePrototype=SDDzcTileSource.prototype=new SDTileSource;SDDzcTileSourcePrototype.base=SDTileSource,SDDzcTileSourcePrototype.isDzc=!0,SDDzcTileSourcePrototype.getTileInfo=function(e){var t=1<<e,i=this.dzcTileSize/(1<<e),n=this.getLevelScale(e),r=this.dzcItemCoords.y,o=this.dzcItemCoords.x,a=Math.floor(r/i),s=Math.floor(o/i);return new SDTileInfo([this.dzcTilesUrl,e,"/",a,"_",s,".",this.dzcImageFormat].join(""),new SDRect(r%i*t,o%i*t,Math.max(1,Math.floor(n*this.width)),Math.max(1,Math.floor(n*this.height))))},SDDzcTileSourcePrototype.levelExists=function(e){return e<=this.dzcMaxLevel},SDDzcTileSourcePrototype.getTilesAbove=function(e,t,i,n){if(void 0===n&&(n=e+1),n>this.dzcMaxLevel){var r,o=this.dziSource;return o&&(r=this.getNumTiles(n))?new SDRect(0,0,r.width-1,r.height-1):null}return new SDRect(0,0,0,0)},function(){var e;for(e in SDDzcTileSourcePrototype)!function(){var t=e,i=SDDzcTileSourcePrototype[t];"base"!==t&&"function"==typeof i&&(SDDzcTileSourcePrototype[t]=function(e,n,r,o){var a=this.dziSource;return e>this.dzcMaxLevel&&a?a[t](e,n,r,o):i.call(this,e,n,r,o)})}()}(),SDDzcTileSourcePrototype.expand=function(){var e;this.dziSource||this.dziSourceRequested||!this.dzcExpansionUrl||(this.dziSourceRequested=!0,e=this,SDDeepZoom_fetchTileSource(this.dzcExpansionUrl,function(t){e.dziSource=t,t.dzcMaxLevel=e.dzcMaxLevel}))},SDDzcTileSourcePrototype.contract=function(){this.dziSource=null,this.dziSourceRequested=!1};var SDDeepZoom=SD.DeepZoom={},SDDeepZoom_storedXml={},SDDeepZoom_parseDziXml=function(e){var t,i,n,r,o=e.getElementsByTagName("Size")[0],a=e.getElementsByTagName("DisplayRect"),s={width:parseInt(o.getAttribute("Width"),10),height:parseInt(o.getAttribute("Height"),10),tileSize:parseInt(e.getAttribute("TileSize"),10),tileOverlap:parseInt(e.getAttribute("Overlap"),10),imageFormat:e.getAttribute("Format"),dispRects:[]};for(t=0;t<a.length;t++)i=a[t],n=i.getElementsByTagName("Rect")[0],r=new SDDisplayRect(parseInt(n.getAttribute("X"),10),parseInt(n.getAttribute("Y"),10),parseInt(n.getAttribute("Width"),10),parseInt(n.getAttribute("Height"),10),0,parseInt(i.getAttribute("MaxLevel"),10)),s.dispRects.push(r);return s},SDDeepZoom_parseDzcXml=function(e){var t,i,n,r,o,a,s,l=e.getAttribute("Format"),c=parseInt(e.getAttribute("MaxLevel"),10),S=parseInt(e.getAttribute("TileSize"),10),h=e.getElementsByTagName("I"),u=h.length,D=new Array(u);for(t=0;t<h.length;t++)i=h[t],n=i.getElementsByTagName("Size")[0],r=i.getElementsByTagName("Viewport"),o={id:parseInt(i.getAttribute("Id"),10),n:parseInt(i.getAttribute("N"),10),width:parseInt(n.getAttribute("Width"),10),
height:parseInt(n.getAttribute("Height"),10),source:i.getAttribute("Source"),viewport:null,dzcTileSize:S,dzcMaxLevel:c,dzcImageFormat:l},r.length>=1&&(a=r[0],s=parseFloat(a.getAttribute("Width")),o.viewport=new SDRect(parseFloat(a.getAttribute("X")),parseFloat(a.getAttribute("Y")),s,s*o.height/o.width)),D[t]=o;return D},SDDeepZoom_parseXml=function(e){var t,i;return"string"==typeof e&&(e=SDXml_parse(e)),e&&e.documentElement?(t=e.documentElement,i=t.tagName,"Image"===i?SDDeepZoom_parseDziXml(t):"Collection"===i?SDDeepZoom_parseDzcXml(t):null):null},SDDeepZoom_getTilesUrl=SDDeepZoom.getTilesUrl=function(e){var t=e.split("/"),i=t.length-1,n=t[i],r=n.lastIndexOf(".");return r>-1&&(t[i]=n.slice(0,r)),t.join("/")+"_files/"},SDDeepZoom_getExpansionUrl=function(e,t){return t?e.substr(0,e.lastIndexOf("/"))+"/"+t:null},SDDeepZoom_makeDzcSources=function(e,t,i){var n,r,o=e.length,a=new Array(o);for(n=0;n<o;n++)r=e[n],r.dzcItemId=r.id,r.dzcItemN=r.n,r.dzcTilesUrl=i,r.dzcExpansionUrl=SDDeepZoom_getExpansionUrl(t,r.source),a[n]=SDDzcTileSource$(r);return a},SDDeepZoom_infoToTileSource=function(e,t){var i,n=SDDeepZoom_getTilesUrl(t);return e instanceof Array?(i=parseInt(t.substring(t.lastIndexOf("#")+1),10),isNaN(i)?SDDeepZoom_makeDzcSources(e,t,n):(e=e[i],e.dzcItemId=e.id,e.dzcItemN=e.n,e.dzcTilesUrl=n,e.dzcExpansionUrl=SDDeepZoom_getExpansionUrl(t,e.source),SDDzcTileSource$(e))):(e.tilesUrl=n,SDDziTileSource$(e))},SDDeepZoom_getTileSource=function(e,t){var i=SDDeepZoom_parseXml(t);return SDDeepZoom_infoToTileSource(i,e)},SDDeepZoom_fetchTileSource=SDDeepZoom.fetchTileSource=function(e,t){var i,n=e.split("#",1)[0],r=SDDeepZoom_storedXml[n];r?setTimeout(function(){t(SDDeepZoom_infoToTileSource(r,e))},0):(i=SDNetwork_tryMakeXmlHttpRequest(n,function(i,n,r){var o,a;if(n){if(a=SDDeepZoom_storedXml[i],!a){if(o=r.responseXML||r.responseText,a=SDDeepZoom_parseXml(o),!a)return;SDDeepZoom_storedXml[i]=a}t(SDDeepZoom_infoToTileSource(a,e))}else SDDebug_warn("DeepZoom.fetchTileSource (callback): XML fetch failed.")},!0),i||SDDebug_warn("DeepZoom.fetchTileSource: Failed to make request."))},SDNetwork=SD.Network={},SDNetwork_MAX_CONNECTIONS_PER_HOSTNAME=SDNetwork.MAX_CONNECTIONS_PER_HOSTNAME=6,SDNetwork_MAX_CONNECTIONS_TOTAL=SDNetwork.MAX_CONNECTIONS_TOTAL=30,SDNetwork_numRequestsTo={},SDNetwork_numRequestsTotal=0,SDNetwork_imageRequests={},SDNetwork_xmlHttpRequests={},SDNetwork_numSpotsAvailable=SDNetwork.numSpotsAvailable=function(e){var t=Math.max(0,SDNetwork_MAX_CONNECTIONS_TOTAL-(SDNetwork_numRequestsTotal||0));return e?Math.min(t,Math.max(0,SDNetwork_MAX_CONNECTIONS_PER_HOSTNAME-(SDNetwork_numRequestsTo[e]||0))):t},SDNetwork_markSpotOpen=SDNetwork.markSpotOpen=function(e){SDNetwork_numRequestsTo[e]=Math.max(0,(SDNetwork_numRequestsTo[e]||0)-1),SDNetwork_numRequestsTotal=Math.max(0,(SDNetwork_numRequestsTotal||0)-1)},SDNetwork_markSpotTaken=SDNetwork.markSpotTaken=function(e){SDNetwork_numRequestsTo[e]=(SDNetwork_numRequestsTo[e]||0)+1,SDNetwork_numRequestsTotal=(SDNetwork_numRequestsTotal||0)+1},SDNetwork_tryMakeImageRequest=SDNetwork.tryMakeImageRequest=SDNetwork_generateTryMakeRequestMethod(SDNetwork_imageRequests,function(e){var t=document.createElement("img");return t.onload=SDNetwork_onImageLoad,t.onerror=t.onabort=SDNetwork_onImageError,t.src=e,t}),SDNetwork_tryMakeXmlHttpRequest=SDNetwork.tryMakeXmlHttpRequest=SDNetwork_generateTryMakeRequestMethod(SDNetwork_xmlHttpRequests,function(e){return SDXml_fetch(e,SDNetwork_onXmlHttpSuccess,SDNetwork_onXmlHttpFailure)}),SDNetwork_onImageLoad=SDNetwork_generateResponseHandler(SDNetwork_imageRequests,!0),SDNetwork_onImageError=SDNetwork_generateResponseHandler(SDNetwork_imageRequests,!1),SDNetwork_onXmlHttpSuccess=SDNetwork_generateResponseHandler(SDNetwork_xmlHttpRequests,!0),SDNetwork_onXmlHttpFailure=SDNetwork_generateResponseHandler(SDNetwork_xmlHttpRequests,!1);Tile.prototype.resetCoverage=function(){this.covered=0},Tile.prototype.covers=function(){return this.drawnOpaque||this.tilesAbove===this.covered},Tile.prototype.isCovered=function(){return this.covered===this.tilesAbove},Tile.prototype.cover=function(){return this.covered++,this.covered>this.tilesAbove&&SDDebug_error("tile coverage is broken!"),this.covered===this.tilesAbove},Tile.prototype.uncover=function(){return this.covered--,this.covered<0&&SDDebug_error("tile coverage is broken"),this.covered+1===this.tilesAbove},Tile.prototype.drawn=function(){return(this.drawnOpaque||this.isCovered())&&SDDebug_error("tile coverage is broken"),this.drawnOpaque=!0,!0};var SDTileLoader_imgInfos={},SDTileLoader_trigger=!1,SDTileLoader_triggerProcessing,SDTileLoader_cache=new SDTileCache(1e3),SDTileLoader_nominations={},SDTileLoader_nullImgInfo={loading:!1,loaded:!1,failed:!1,img:null,owners:null,tileInfos:null};SDTileLoader_triggerProcessing=function(){SDTileLoader_trigger||(SDTileLoader_trigger=!0,setTimeout(SDTileLoader_processNominations,0))};var SDImageManager=SD.ImageManager={},SDImageManager_markupCheckToken=null,SDImageManager_isEnabled=!0;SDImageManager.register=function(e,t){if(SDImageManager_isEnabled)return SDTimer.register(e,t)},SDImageManager.unregister=function(e){return SDTimer.unregister(e)},SDImageManager.enableMarkupChecking=function(){SDImageManager_markupCheckToken||(SDImageManager_markupCheckToken=SDTimer.register(SDImageManager_checkForInit))},SDImageManager.disableMarkupChecking=function(){SDImageManager_markupCheckToken&&(SDTimer.unregister(SDImageManager_markupCheckToken),SDImageManager_markupCheckToken=null)},SDImageManager.enable=function(){SDImageManager_isEnabled=!0},SDImageManager.disable=function(){SDImageManager_isEnabled=!1};var SDDrawer_CANVAS_API_AVAILABLE="function"==typeof document.createElement("canvas").getContext,SDDrawer=function(e,t){this.container=e,this.normHeight=t},SDDrawerPrototype=SDDrawer.prototype,SDDrawer_$=function(e,t){return SDDrawer_CANVAS_API_AVAILABLE?new SDCanvasDrawer(e,t):new SDImgDrawer(e,t)},SDDrawer_nullDrawer=new SDDrawer;SDDrawerPrototype.drawTile=function(e,t,i){return e},SDDrawerPrototype.addLevelOnTop=function(){return!0},SDDrawerPrototype.addLevelBehind=function(e){return!0},SDDrawerPrototype.removeLevel=function(e){},SDDrawerPrototype.updateBlend=function(e,t,i){},SDDrawerPrototype.updateFade=function(e,t){},SDDrawerPrototype.discardTile=function(e,t){},SDDrawerPrototype.setLevelDimensions=function(e){};var SDCanvasDrawer=function(){SDDrawer.apply(this,arguments)},SDCanvasDrawerPrototype=SDCanvasDrawer.prototype=new SDDrawer;SDCanvasDrawerPrototype.drawTile=function(e,t,i,n){var r,o,a,s,l,c,S,h=t.crop,u=t.bounds,D=0;return e.complete?("number"!=typeof n?n=t.opacity:D=t.opacity,i.canvas?(r=i.canvas,o=r.getContext("2d"),a=i.fullSize,s=i.normalizedBounds,1!==n&&(o.save(),D=D||0,o.globalAlpha=(n-D)/(1-D)),c=a.width/s.width,S=a.height/s.height,l=new SDRect((u.x-s.x)*c,(u.y-s.y)*S,u.width*c,u.height*S),h?o.drawImage(e,h.x,h.y,h.width,h.height,l.x,l.y,l.width,l.height):o.drawImage(e,l.x,l.y,l.width,l.height),1!==n&&o.restore(),e):void SDDebug_warn("SDCanvasDrawer: nonexistent level")):void SDDebug_warn("Seadragon2.Canvas.drawImage: ignoring incomplete image: "+e.src)},SDCanvasDrawerPrototype.updateBlend=function(e,t,i){t.canvas||SDDebug_error("CanvasDrawer: Attempting to blend tile on nonexistent level!"),this.drawTile(e.view,e,t,i)},SDCanvasDrawerPrototype.updateFade=function(e,t){SDElement_setOpacity(e.canvas,t)},SDCanvasDrawerPrototype.positionLevel=function(e){var t=e.canvas,i=e.normalizedBounds,n=t.style;n.left=(100*i.x).toFixed(8)+"%",n.top=(i.y/this.normHeight*100).toFixed(8)+"%",n.width=(100*i.width).toFixed(8)+"%",n.height=(i.height/this.normHeight*100).toFixed(8)+"%"},SDCanvasDrawerPrototype.setLevelDimensions=function(e){var t,i,n,r,o,a=e.view.canvas,s=e.bounds,l=e.tiles,c=s.x,S=s.y,h=s.width+c,u=s.height+S,D=e.dimensions;if(o=l[c][S].bounds.union(l[h][u].bounds),D=o.scale(D.width,new SDPoint(0,0)),D.width=SDMath_round(D.width)||1,D.height=SDMath_round(D.height)||1,a.width=D.width,a.height=D.height,e.view.fullSize=D,e.view.normalizedBounds=o,this.positionLevel(e.view),l)for(n=c;n<=h;n++)for(t=l[n],r=S;r<=u;r++)i=t[r],i.view&&this.drawTile(i.view,i,e.view)},SDCanvasDrawerPrototype.makeCanvas=function(e){var t=document.createElement("canvas"),i=t.style;return i.display="block",i.position="absolute",i.overflow="hidden",i.width="100%",i.height="100%",e.canvas=t,e.normalizedBounds=new SDRect(0,0,1,this.normHeight),t},SDCanvasDrawerPrototype.addLevelOnTop=function(){var e={};return this.container.appendChild(this.makeCanvas(e)),e},SDCanvasDrawerPrototype.addLevelBehind=function(e){var t={};return this.container.insertBefore(this.makeCanvas(t),e.canvas),t},SDCanvasDrawerPrototype.removeLevel=function(e){this.container.removeChild(e.canvas),delete e.canvas};var SDImgDrawer_MS_INTERPOLATION_MODE=document.documentMode?"bicubic":"nearest-neighbor",SDImgDrawer=function(){SDDrawer.apply(this,arguments)},SDImgDrawerPrototype=SDImgDrawer.prototype=new SDDrawer;SDImgDrawerPrototype.drawTile=function(e,t,i){var n,r,o,a,s=t.crop,l=t.bounds,c=t.opacity;return i||SDDebug_error("SDImgDrawer: nonexistent level"),n=document.createElement("img"),r=n.style,n.src=e.src,r.position="absolute",r.msInterpolationMode=SDImgDrawer_MS_INTERPOLATION_MODE,s?(o=document.createElement("div"),a=o.style,a.position="absolute",a.overflow="hidden",r.left=(-100*s.x/s.width).toFixed(8)+"%",r.top=(-100*s.y/s.height).toFixed(8)+"%",r.width=(100*e.width/s.width).toFixed(8)+"%",r.height=(100*e.height/s.height).toFixed(8)+"%",o.appendChild(n)):(o=n,a=r),a.left=(100*l.x).toFixed(8)+"%",a.top=(100*l.y/this.normHeight).toFixed(8)+"%",a.width=(100*l.width).toFixed(8)+"%",a.height=(100*l.height/this.normHeight).toFixed(8)+"%",i.appendChild(o),"number"==typeof c&&SDElement_setOpacity(o,c),o},SDImgDrawerPrototype.updateBlend=function(e,t,i){SDElement_setOpacity(e.view,i)},SDImgDrawerPrototype.updateFade=function(e,t){SDElement_setOpacity(e,t)},SDImgDrawerPrototype.makeDiv=function(){var e=document.createElement("div"),t=e.style;return t.display="block",t.position="absolute",t.overflow="visible",t.width="100%",t.height="100%",e},SDImgDrawerPrototype.addLevelOnTop=function(){var e=this.makeDiv();return this.container.appendChild(e),e},SDImgDrawerPrototype.addLevelBehind=function(e){var t=this.makeDiv();return this.container.insertBefore(t,e),t},SDImgDrawerPrototype.removeLevel=function(e){this.container.removeChild(e)},SDImgDrawerPrototype.discardTile=function(e,t){t.removeChild(e.view)};var SDImageState=function(e,t,i,n){this.blendInTime=i||0,this.fadeOutTime=n||0,this.source=e,this.drawer=t,this.maxLevel=e.minLevel-1,this.clip=new SDRect(0,0,1,e.normHeight),this.levels={},this.position=SDRect_nullRect},SDImageStatePrototype=SDImageState.prototype,SDImageState_animator=SDTimer;SDImageStatePrototype.update=function(e,t,i){var n,r=this.source,o=this.position,a=r.normHeight;if(i=i||0,e&&!o.equals(e)&&(this.position=e),t&&(t=new SDRect(t.x/e.width,t.y*a/e.height,t.width/e.width,t.height*a/e.height)),e)for(n=SDMath_clamp(SDMath_ceil(SDMath_log2(SDMath_max(e.width,e.height))-i+r.sharpen),r.minLevel,r.maxLevel),r.isDzc&&(n>r.dzcMaxLevel?r.expand():r.contract());!r.levelExists(n);)n--;else n=this.maxLevel;n!==this.maxLevel&&this.setLevel(n),t&&!t.equals(this.clip)&&this.setClipBounds(t)},SDImageStatePrototype.setLevel=function(e){var t,i,n,r=this.maxLevel,o=this.clip;if(this.maxLevel=e,r<e)for(t=r+1;t<=e;t++)i=this.initLevelData(t),this.setLevelClipBounds(i,o),this.drawLevel(i,null,!0);else if(r>e){for(t=r;t>e;t--)i=this.levels[t],i&&i.visible&&(n=this.levels[t]),this.fadeLevel(t),this.setLevelClipBounds(i,SDRect_nullRect);this.redrawAllLevels(n)}},SDImageStatePrototype.redrawAllLevels=function(e){var t,i=this.maxLevel,n=this.source.minLevel,r=this.levels;for(t=i;t>=n;t--)this.drawLevel(r[t],e),r[t].visible&&(e=r[t])},SDImageStatePrototype.setClipBounds=function(e){var t,i=this.source.minLevel,n=this.maxLevel,r=this.levels;for(this.clip=e,t=i;t<=n;t++)this.setLevelClipBounds(r[t],e);this.redrawAllLevels()},SDImageStatePrototype.destroy=function(){var e,t=this.levels;for(e=this.minLevel;e<=this.maxLevel;e++)t[e].view&&this.drawer.removeLevel(t[e].view);this.levels=null,this.blendTile=SDFunction_EMPTY,this.onTileDrawn=SDFunction_EMPTY,this.getTilePriority=function(){return 0},this.drawer=null},SDImageStatePrototype.blendTile=function(e,t){var i=(new Date).getTime(),n=this.levels[t.level];t.opacity=0,t.view=this.drawer.drawTile(e,t,n.view),SDImageState_animator.register(SDImageState_blendCallback,{levelData:n,tile:t,startTime:i,state:this})},SDImageStatePrototype.fadeLevel=function(e){var t=this.levels[e],i=(new Date).getTime();t.fading=!0,SDImageState_animator.register(SDImageState_fadeCallback,{state:this,level:e,startTime:i,levelData:t})},SDImageStatePrototype.initLevelData=function(e){var t=this.levels,i=t[e];return i&&i.visible&&(this.drawer.removeLevel(i.view),i.visible=!1),t[e]=i=new Level(e,this.source),i},SDImageStatePrototype.checkRemoveLevel=function(e){e.tilesVisible<0&&SDDebug_error("coverage is broken"),0!==e.tilesVisible||e.fading||(e.visible=!1,e.view&&(this.drawer.removeLevel(e.view),e.view=null))},SDImageStatePrototype.onUncover=function(e){e.uncover()&&(e.inBounds&&this.levels[e.level].tilesVisible++,e.tileBelow&&this.onUncover(e.tileBelow))},SDImageStatePrototype.onCover=function(e){var t;e.cover()&&(t=this.levels[e.level],e.view&&(this.drawer.discardTile(e,t.view),e.view=null),e.drawnOpaque?e.drawnOpaque=!1:e.tileBelow&&this.onCover(e.tileBelow),t.tilesVisible--,this.checkRemoveLevel(t))},SDImageStatePrototype.onDrawn=function(e){e.drawn(),e.tileBelow&&this.onCover(e.tileBelow)},SDImageStatePrototype.setLevelClipBounds=function(e,t){var i,n,r,o,a,s,l=e.num,c=this.source,S=e.bounds,h=c.getTilesInRect(l,t),u=e.tiles,D=h.x,d=h.y,m=h.height+d,g=h.width+D,p=S.x,f=S.y,v=p+S.width,w=f+S.height,_=e.fading&&this.drawer===SDDrawer_nullDrawer;if(!u||!S)return void SDDebug_error("uninitialized level "+l);if(!h.equals(S)){for(r=D;r<=g;r++)for(i=u[r],i||(u[r]={},i=u[r]),o=d;o<=m;o++)n=i[o],n||(a=c.getTileBelow(l,r,o),a?(s=this.levels[l-1].tiles[a.x][a.y],s||SDDebug_error("coverage is broken")):s=null,i[o]=new Tile(e.num,r,o,c,s),e.tilesVisible++);for(r=p;r<=v;r++){for(i=u[r],o=f;o<=w;o++)r>=D&&r<=g&&o>=d&&o<=m?o=m:(n=i[o],n.view&&!e.fading&&this.drawer.discardTile(n,e.view),n.isCovered()||e.tilesVisible--,n.inBounds=!1,n.drawnOpaque&&this.onUncover(n.tileBelow),_||delete i[o]);!_&&(r<D||r>g)&&delete u[r]}_||(e.bounds=h),this.checkRemoveLevel(e),e.visible&&!e.fading&&this.drawer.setLevelDimensions(e)}},SDImageStatePrototype.drawLevel=function(e,t,i){var n,r,o,a,s,l,c,S=e.bounds,h=e.num,u=S.x,D=u+S.width,d=S.y,m=d+S.height,g=this.source,p=this.drawer;if(0!==e.tilesVisible)for(e.tilesVisible<0&&SDDebug_error("coverage is broken"),e.visible||(e.visible=!0,t?e.view=p.addLevelBehind(t.view):e.view=p.addLevelOnTop(),p.setLevelDimensions(e)),n=u;n<=D;n++)for(r=d;r<=m;r++)g.tileExists(h,n,r)&&(o=new SDPoint(n,r),a=e.tiles[n][r],a.covers()||a.view||a.loading||(s=SDTileLoader_getImgInfo(a.url),s.failed||(l=a.bounds,s.loaded?i?this.blendTile(s.img,a):(a.opacity=1,a.view=p.drawTile(s.img,a,e.view),this.onDrawn(a)):(c=this.position,l=l.intersect(this.clip),l=new SDRect(l.x*c.width+c.x,l.y*c.height/g.normHeight+c.y,l.width*c.width,l.height*c.height/g.normHeight),a.area=l.getArea(),a.distance=l.getCenter().distanceTo(SDPoint_origin),a.loading=!0,SDTileLoader_nominate(a,SDImageState_onTileLoad,{levelData:e,state:this})))))};var SDImage_init,SDImage=SD.Image=function(e,t){return SDObject_extend(this,e),this.state=null,this.lastSrc="",this.container=document.createElement("div"),t&&t.attributes.src?this.src=t.attributes.src.value:this.src=this.lastSrc,this.complete=!0,t||(t=SDElement_dce.call(document,"sdimg")),SDImage_init(SDObject_extend(t,this,!0))},SDImagePrototype=SDImage.prototype,SDImage_pixelRatio=0;"undefined"!=typeof devicePixelRatio&&(SDImage_pixelRatio=SDMath_log2(devicePixelRatio)),SDElement_registerCustomElement("sdimg",SDImage),SDImagePrototype.blendTime=500,SDImagePrototype.fadeTime=500,SDImagePrototype.manualUpdates=!1,SDImagePrototype.clipParent=null,SDImagePrototype.immediateMode=!0,SDImagePrototype.blur=0,function(){var e,t,i,n="sdimg",r="display:inline-block",o=n+" {"+r+"}";if(document.createStyleSheet)try{t=document.styleSheets.length>0?document.styleSheets[0]:document.createStyleSheet(),t.addRule(n,r,0)}catch(a){SDDebug_warn("Error while creating default styles: "+a.message)}else e=document.documentElement.firstChild,t=document.createElement("style"),i=document.createTextNode(o),t.appendChild(i),e.insertBefore(t,e.firstChild)}(),SDImage_init=function(e){var t=e.container,i=t.style;return t.className="sdimgcontainerdiv",i.textAlign="left",i.overflow="hidden",e.style&&(e.appendChild(t),i.position="relative",i.width=i.height="100%"),e.manualUpdates||(e.timerID=SDImageManager.register(SDImage_onTick,e)),e},SDImagePrototype.update=function(e,t){SDImage_onTick(this,null,e,t)},SDImagePrototype.destroy=function(){this.drawer.destroy(),this.timerID&&SDImageManager.unregister(this.timerID)},SDImage.drawImage=function(e,t,i,n,r,o,a,s,l,c){var S,h,u,D,d,m,g,p,f,v,w,_,y,T,b,I,M,x,P,E,L,k,R,N,z=!0;if(t=t.state,!t)return SDDebug_warn("Image.drawImage: Image isn't ready yet!"),!1;for(N=t.maxLevel,void 0===r?(a=i,s=n,l=t.position.width,c=t.position.height):void 0===a?(a=i,s=n,l=r,c=o):(e.save(),e.beginPath(),e.rect(a,s,l,c),e.clip(),R=!0,a-=i*l/r,s-=n*c/o,l*=t.position.width/r,c*=t.position.height/o),S=t.source.normHeight,h=t.levels,u=t.source.minLevel;m=h[u];u++)if(m.visible){for(p=m.bounds,g=m.opacity,1!==g&&(e.save(),e.globalAlpha*=g,z=!1),v=p.x,_=p.y,w=v+p.width,y=_+p.height,f=m.tiles,D=v;D<=w;D++)for(T=f[D],d=_;d<=y;d++)b=T[d],b.view?(I=b.opacity,1!==I&&(e.save(),e.globalAlpha*=I,z=!1),M=b.crop,x=b.bounds,P=a+x.x*l,E=s+x.y*c/S,L=x.width*l,k=x.height*c/S,M?e.drawImage(b.view,M.x,M.y,M.width,M.height,P,E,L,k):e.drawImage(b.view,P,E,L,k),1!==I&&e.restore()):z=!1;1!==g&&e.restore()}return(N!==u-1||h[N]&&!h[N].visible)&&(z=!1),R&&e.restore(),z};